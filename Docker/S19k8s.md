
# k8s

integrated platforms: 1- containerd.io (low level) 2- CRI-O (high level) 3- CRI-dockerd(mirantis) (mid level) [docker (highlevel)]


### mirantis

is cloud tools - its a tools of openstack - 

before version 1.24 k8s mid level connection between k8s and docker was dockershim.

k8s (v1.23) ---> dockershim -----> docker

but in version 1.24 , k8s to upgrade older version to it introduced cri-o dockerd (by mirantis co.) to keep connection with docker in servers

k8s (v1.24) ---> cri-o dockerd (by mirantis co.) -----> docker


https://kubernetes.io/docs/setup/production-environment/container-runtimes


Note: These instructions assume that you are using the cri-dockerd adapter to integrate Docker Engine with Kubernetes.

k8s prioroty for container runtime:

1- containerd  --- is recommanded
2- CRI-O
3- Docker Engine
4- Mirantis Container Runtime

for use docker engin follow instruction:

Docker Engine
Note: These instructions assume that you are using the cri-dockerd adapter to integrate Docker Engine with Kubernetes.
On each of your nodes, install Docker for your Linux distribution as per Install Docker Engine.

Install cri-dockerd, following the instructions in that source code repository.

For cri-dockerd, the CRI socket is /run/cri-dockerd.sock by default.

Mirantis Container Runtime 
Mirantis Container Runtime (MCR) is a commercially available container runtime that was formerly known as Docker Enterprise Edition.

You can use Mirantis Container Runtime with Kubernetes using the open source cri-dockerd component, included with MCR.

To learn more about how to install Mirantis Container Runtime, visit MCR Deployment Guide.

Check the systemd unit named cri-docker.socket to find out the path to the CRI socket.




### etcd or cluster store:

its stand for /etc distributed. its a store to keep config files. acces only by api server. its a key-value based meta data storage to manage critical infor mation about cluster. its highly recommand to have backup plan for etcd in cluster .

cause if master node in k8s crash or has benn down , all cluster would be lost. if you have backup from etcd just run another k8s and restore etcd in it and all you have restore in it. 


interview qustion: k8s backup tools: 1- k10 (90% market - kasten.io its buy by veeam backup) 2- velero (10% market)  3- ...... other is not important


practice: try to install and use kasten. its free up to 5 node ( cluster).



#### K8s have customise versions:  

in private env. --> openshift (by rehl and need license - OKD -can install in private cloud ) - suse rancher (by suse - can install in private cloud.) 


in public env. --> eks - aks - gke - ibm-kube - oracle - ..


its important you learn use k8s in general. 


#### kube - scheduler 

assign work to nodes - decide where to start work loads , on which node. choosing node. multiple criteria is needed and can be set to sceduler. 
individual & collective resource requirements, hardware/software/policy constraints, affinity & anti-affinity specifications, data locality & inter-workload interference.


affinity & anti affinity:

some app needs to be up beside together. side care container. for ex.: redis and backends pod. if backed shuts in any node and up in other node k8s automatically down redis and up it in beside backends pod. this is affinity and k8s has feature to set this attr.

In the same way, it is anti-affinity. 

#### kube-controller-manager

watch for changes. kubelet is report currentstat/desiredstat to kube-controller to calculate(sum) it by kube-controller. 
 controller is sprated process (all module) that have child proc( with one pid) all compiled into a single binary and run in a single process.

***It includes***: 

**Node**(all nodes is up and runs with hello message with time schedule )/**Replication**(sum of currentstat/desiredstat 's is correct)/**Endpoints**(network interfaces of pode - ep - with ping it)/**Service-Account**(account managment- AAA - acoount an tokens ,... )/**Token Controller**(to join workers) 

arcitecture is very important for t-shoot. 




















